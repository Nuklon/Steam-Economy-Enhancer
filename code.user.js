// ==UserScript==
// @name        Steam Economy Enhancer
// @icon        https://upload.wikimedia.org/wikipedia/commons/8/83/Steam_icon_logo.svg
// @namespace   https://github.com/Nuklon
// @author      Nuklon
// @license     MIT
// @version     6.8.4
// @description Enhances the Steam Inventory and Steam Market.
// @match     *://steamcommunity.com/id/*/inventory*
// @match     *://steamcommunity.com/profiles/*/inventory*
// @match     *://steamcommunity.com/market*
// @match     *://steamcommunity.com/tradeoffer*
// @require     https://code.jquery.com/jquery-3.3.1.min.js
// @require     https://code.jquery.com/ui/1.12.1/jquery-ui.min.js
// @require     https://raw.githubusercontent.com/kapetan/jquery-observe/ca67b735bb3ae8d678d1843384ebbe7c02466c61/jquery-observe.js
// @require     https://cdnjs.cloudflare.com/ajax/libs/paginationjs/2.1.2/pagination.min.js
// @require     https://cdnjs.cloudflare.com/ajax/libs/async/2.6.0/async.js
// @require     https://cdnjs.cloudflare.com/ajax/libs/localforage/1.7.1/localforage.min.js
// @require     https://moment.github.io/luxon/global/luxon.min.js
// @require     https://cdnjs.cloudflare.com/ajax/libs/list.js/1.5.0/list.js
// @require     https://github.com/rmariuzzo/checkboxes.js/releases/download/v1.2.2/jquery.checkboxes-1.2.2.min.js
// @grant       unsafeWindow
// @homepageURL https://github.com/Nuklon/Steam-Economy-Enhancer
// @supportURL  https://github.com/Nuklon/Steam-Economy-Enhancer/issues
// @downloadURL https://raw.githubusercontent.com/Nuklon/Steam-Economy-Enhancer/master/code.user.js
// @updateURL   https://raw.githubusercontent.com/Nuklon/Steam-Economy-Enhancer/master/code.user.js
// ==/UserScript==
(()=>{(function(e,te){e.noConflict(!0);var Be=luxon.DateTime;let qt=753,Ne=0,He=1,_e=2,Oe=3,ne="#8A4243",de="#407736",$e="#908F44",gt="#496424",vt="#837433",ht="#813030",kt="#26566c",D=null,E=1,Re=2;var j=[],se=0,Q=0,Ue=0,et=0,qe=0,Me='<div class="spinner"><div class="rect1"></div>&nbsp;<div class="rect2"></div>&nbsp;<div class="rect3"></div>&nbsp;<div class="rect4"></div>&nbsp;<div class="rect5"></div>&nbsp;</div>',J=0,bt=!1,De=typeof unsafeWindow.g_rgWalletInfo!="undefined"&&unsafeWindow.g_rgWalletInfo!=null||typeof unsafeWindow.g_bLoggedIn!="undefined"&&unsafeWindow.g_bLoggedIn,Z=window.location.href.includes(".com/market")?window.location.href.includes("market/listings")?He:Ne:window.location.href.includes(".com/tradeoffer")?_e:Oe,h=new Y(unsafeWindow.g_rgAppContextData,typeof unsafeWindow.g_strInventoryLoadURL!="undefined"&&unsafeWindow.g_strInventoryLoadURL!=null?unsafeWindow.g_strInventoryLoadURL:location.protocol+"//steamcommunity.com/my/inventory/json/",De?unsafeWindow.g_rgWalletInfo:void 0),tt=De&&h!=null&&h.walletInfo!=null&&h.walletInfo.wallet_currency!=null?h.walletInfo.wallet_currency:3,$=unsafeWindow.GetCurrencySymbol(unsafeWindow.GetCurrencyCode(tt));let pe="SETTING_MIN_NORMAL_PRICE",fe="SETTING_MAX_NORMAL_PRICE",me="SETTING_MIN_FOIL_PRICE",ge="SETTING_MAX_FOIL_PRICE",ve="SETTING_MIN_MISC_PRICE",he="SETTING_MAX_MISC_PRICE",ke="SETTING_PRICE_OFFSET",be="SETTING_PRICE_MIN_CHECK_PRICE",ie="SETTING_PRICE_ALGORITHM",ye="SETTING_PRICE_IGNORE_LOWEST_Q",Ie="SETTING_PRICE_HISTORY_HOURS",we="SETTING_INVENTORY_PRICE_LABELS",Te="SETTING_TRADEOFFER_PRICE_LABELS",nt="SETTING_LAST_CACHE",ue="SETTING_RELIST_AUTOMATICALLY",Se="SETTING_MARKET_PAGE_COUNT",Dt="SETTING_INVENTORY_PRICES";var rt={SETTING_MIN_NORMAL_PRICE:.05,SETTING_MAX_NORMAL_PRICE:2.5,SETTING_MIN_FOIL_PRICE:.15,SETTING_MAX_FOIL_PRICE:10,SETTING_MIN_MISC_PRICE:.05,SETTING_MAX_MISC_PRICE:10,SETTING_PRICE_OFFSET:0,SETTING_PRICE_MIN_CHECK_PRICE:0,SETTING_PRICE_ALGORITHM:1,SETTING_PRICE_IGNORE_LOWEST_Q:1,SETTING_PRICE_HISTORY_HOURS:12,SETTING_INVENTORY_PRICE_LABELS:1,SETTING_TRADEOFFER_PRICE_LABELS:1,SETTING_LAST_CACHE:0,SETTING_RELIST_AUTOMATICALLY:0,SETTING_MARKET_PAGE_COUNT:100};function Y(t,n,r){this.appContext=t,this.inventoryUrl=n,this.walletInfo=r,this.inventoryUrlBase=n.replace("/inventory/json",""),this.inventoryUrlBase.endsWith("/")||(this.inventoryUrlBase+="/")}function jt(t,n,r){return t.replace(new RegExp(n,"g"),r)}function Ae(t){for(var n="";n!=t;)n=t,t=t.replace("?","%3F").replace("#","%23").replace("	","%09");return t}var it=localforage.createInstance({name:"see_persistent"}),oe,yt=new URL(window.location.href),It=yt.searchParams.get("no-cache")!=null;if(at("SESSION")==null||It){var Ee=y(nt);Ee>5&&(Ee=0),B(nt,Ee+1),oe=localforage.createInstance({name:"see_session_"+Ee}),oe.clear(),St("SESSION",Ee)}else oe=localforage.createInstance({name:"see_session_"+at("SESSION")});function wt(t){try{return localStorage.getItem(t)}catch(n){return null}}function Tt(t,n){try{return localStorage.setItem(t,n),!0}catch(r){return C("Failed to set local storage item "+t+", "+r+"."),!1}}function at(t){try{return sessionStorage.getItem(t)}catch(n){return null}}function St(t,n){try{return sessionStorage.setItem(t,n),!0}catch(r){return C("Failed to set session storage item "+t+", "+r+"."),!1}}function y(t){return wt(t)||(t in rt?rt[t]:null)}function B(t,n){Tt(t,n)}function st(){var t=e('<div id="price_options"><div style="margin-bottom:6px;">Calculate prices as the:&nbsp;<select class="price_option_input" style="background-color: black;color: white;border: transparent;" id="'+ie+'"><option value="1"'+(y(ie)==1?'selected="selected"':"")+'>Maximum of the average history and lowest sell listing</option><option value="2" '+(y(ie)==2?'selected="selected"':"")+'>Lowest sell listing</option><option value="3" '+(y(ie)==3?'selected="selected"':"")+'>Highest current buy order or lowest sell listing</option></select><br/></div><div style="margin-bottom:6px;">Hours to use for the average history calculated price:&nbsp;<input class="price_option_input" style="background-color: black;color: white;border: transparent;" type="number" step="2" id="'+Ie+'" value='+y(Ie)+'></div><div style="margin-bottom:6px;">The value to add to the calculated price (minimum and maximum are respected):&nbsp;<input class="price_option_input price_option_price" style="background-color: black;color: white;border: transparent;" type="number" step="0.01" id="'+ke+'" value='+y(ke)+'><br/></div><div style="margin-top:6px">Use the second lowest sell listing when the lowest sell listing has a low quantity:&nbsp;<input class="price_option_input" style="background-color: black;color: white;border: transparent;" type="checkbox" id="'+ye+'" '+(y(ye)==1?'checked=""':"")+`><br/></div><div style="margin-top:6px;">Don't check market listings with prices of and below:&nbsp;<input class="price_option_input price_option_price" style="background-color: black;color: white;border: transparent;" type="number" step="0.01" id="`+be+'" value='+y(be)+'><br/></div><div style="margin-top:24px">Show price labels in inventory:&nbsp;<input class="price_option_input" style="background-color: black;color: white;border: transparent;" type="checkbox" id="'+we+'" '+(y(we)==1?'checked=""':"")+'></div><div style="margin-top:6px">Show price labels in trade offers:&nbsp;<input class="price_option_input" style="background-color: black;color: white;border: transparent;" type="checkbox" id="'+Te+'" '+(y(Te)==1?'checked=""':"")+'></div><div style="margin-top:24px"><div style="margin-bottom:6px;">Minimum:&nbsp;<input class="price_option_input price_option_price" style="background-color: black;color: white;border: transparent;" type="number" step="0.01" id="'+pe+'" value='+y(pe)+'>&nbsp;and maximum:&nbsp;<input class="price_option_input price_option_price" style="background-color: black;color: white;border: transparent;" type="number" step="0.01" id="'+fe+'" value='+y(fe)+'>&nbsp;price for normal cards<br/></div><div style="margin-bottom:6px;">Minimum:&nbsp;<input class="price_option_input price_option_price" style="background-color: black;color: white;border: transparent;" type="number" step="0.01" id="'+me+'" value='+y(me)+'>&nbsp;and maximum:&nbsp;<input class="price_option_input price_option_price" style="background-color: black;color: white;border: transparent;" type="number" step="0.01" id="'+ge+'" value='+y(ge)+'>&nbsp;price for foil cards<br/></div><div style="margin-bottom:6px;">Minimum:&nbsp;<input class="price_option_input price_option_price" style="background-color: black;color: white;border: transparent;" type="number" step="0.01" id="'+ve+'" value='+y(ve)+'>&nbsp;and maximum:&nbsp;<input class="price_option_input price_option_price" style="background-color: black;color: white;border: transparent;" type="number" step="0.01" id="'+he+'" value='+y(he)+'>&nbsp;price for other items<br/></div><div style="margin-top:24px;margin-bottom:6px;">Market items per page:&nbsp;<input class="price_option_input price_option_price" style="background-color: black;color: white;border: transparent;" type="number" step="0.01" id="'+Se+'" value='+y(Se)+'><br/><div style="margin-top:6px;">Automatically relist overpriced market listings (slow on large inventories):&nbsp;<input id="'+ue+'" class="market_relist_auto" type="checkbox" '+(y(ue)==1?'checked=""':"")+"></label></div></div></div>"),n=unsafeWindow.ShowConfirmDialog("Steam Economy Enhancer",t).done(function(){B(pe,e("#"+pe,t).val()),B(fe,e("#"+fe,t).val()),B(me,e("#"+me,t).val()),B(ge,e("#"+ge,t).val()),B(ve,e("#"+ve,t).val()),B(he,e("#"+he,t).val()),B(ke,e("#"+ke,t).val()),B(be,e("#"+be,t).val()),B(ie,e("#"+ie,t).val()),B(ye,e("#"+ye,t).prop("checked")?1:0),B(Ie,e("#"+Ie,t).val()),B(Se,e("#"+Se,t).val()),B(ue,e("#"+ue,t).prop("checked")?1:0),B(we,e("#"+we,t).prop("checked")?1:0),B(Te,e("#"+Te,t).prop("checked")?1:0),window.location.reload()})}var ot=!1,Ce=document.createElement("div");Ce.setAttribute("id","logger");function lt(){if(!ot){var t=document.getElementById("logger");t.scrollTop=t.scrollHeight}}function M(t){Ce.innerHTML+=t+"<br/>",lt()}function Yt(){Ce.innerHTML="",lt()}function C(t){bt&&console.log(t)}function je(t){var n=Ve(t),r=Ot(t);return Et(n,r)}function Et(t,n){var r=0,i=0;t?(r=y(n?ge:fe),i=y(n?me:pe)):(r=y(he),i=y(ve)),r=r*100,i=i*100;var o=h.getPriceBeforeFees(r),p=h.getPriceBeforeFees(i);return{maxPrice:r,minPrice:i,maxPriceBeforeFees:o,minPriceBeforeFees:p}}function Ct(t){var n=0,r=0;if(t!=null){var i=Date.now()-y(Ie)*60*60*1e3;t.forEach(function(o){var p=new Date(o[0]);p.getTime()>i&&(n+=o[1]*o[2],r+=o[2])})}return r==0?0:(n=Math.floor(n/r),h.getPriceBeforeFees(n))}function xt(t){if(typeof t=="undefined"||t==null||t.lowest_sell_order==null||t.sell_order_graph==null)return 0;var n=h.getPriceBeforeFees(t.lowest_sell_order),r=y(ye)==1;if(r&&t.sell_order_graph.length>=2){var i=h.getPriceBeforeFees(t.sell_order_graph[1][0]*100);if(i>n){var o=t.sell_order_graph[0][1],p=t.sell_order_graph[1][1],m=100*(o/p);(p>=1e3&&m<=5||p<1e3&&m<=10||p<100&&m<=15||p<50&&m<=20||p<25&&m<=25||p<10&&m<=30)&&(n=i)}}return n}function Pt(t){return typeof t=="undefined"?0:h.getPriceBeforeFees(t.highest_buy_order)}function Le(t,n,r,i,o){var p=Ct(t),m=xt(n),T=Pt(n),A=y(ie)==1,K=y(ie)==3,x=0;K&&T!==-2?x=T:p<m||!A?x=m:x=p;var H=!1;if(x==0&&(x=o,H=!0),!H&&r&&(x=x+y(ke)*100),x=Mt(x,i,o),typeof n!="undefined"&&n!=null&&n.highest_buy_order!=null){var P=h.getPriceBeforeFees(n.highest_buy_order);P>x&&(x=P)}return x}function F(t,n){return Math.floor(Math.random()*(n-t+1))+t}function Ye(t){return(Math.log10((t^t>>31)-(t>>31))|0)+1}function Fe(t,n){return t=t.toString(),t.length<n?Fe("0"+t,n):t}function ee(t){return t.replace(/\D/g,"")}function xe(t){return t==null?null:t.description!=null&&t.description.market_hash_name!=null?Ae(t.description.market_hash_name):t.description!=null&&t.description.name!=null?Ae(t.description.name):t.market_hash_name!=null?Ae(t.market_hash_name):t.name!=null?Ae(t.name):null}function Nt(t){if(t==null)return!1;var n=t.tags!=null?t.tags:t.description!=null&&t.description.tags!=null?t.description.tags:null;if(n!=null){var r=!1;if(n.forEach(function(i){i.category=="Type"&&i.internal_name=="Supply Crate"&&(r=!0)}),r)return!0}}function Ve(t){if(t==null)return!1;var n=t.tags!=null?t.tags:t.description!=null&&t.description.tags!=null?t.description.tags:null;if(n!=null){var r=!1;if(n.forEach(function(o){o.category=="item_class"&&o.internal_name=="item_class_2"&&(r=!0)}),r)return!0}if(t.owner_actions!=null){for(var i=0;i<t.owner_actions.length;i++)if(t.owner_actions[i].link!=null&&t.owner_actions[i].link.toString().toLowerCase().includes("gamecards"))return!0}return!!(t.type!=null&&t.type.toLowerCase().includes("trading card"))}function Ot(t){if(!Ve(t))return!1;var n=t.tags!=null?t.tags:t.description!=null&&t.description.tags!=null?t.description.tags:null;if(n!=null){var r=!1;if(n.forEach(function(o){o.category=="cardborder"&&o.internal_name=="cardborder_1"&&(r=!0)}),r)return!0}if(t.owner_actions!=null){for(var i=0;i<t.owner_actions.length;i++)if(t.owner_actions[i].link!=null&&t.owner_actions[i].link.toString().toLowerCase().includes("gamecards")&&t.owner_actions[i].link.toString().toLowerCase().includes("border"))return!0}return!!(t.type!=null&&t.type.toLowerCase().includes("foil trading card"))}function Rt(t,n,r){if(r==null||!r.wallet_fee)return{fees:0};n=n==null?0:n;for(var i=0,o=parseInt((t-parseInt(r.wallet_fee_base))/(parseFloat(r.wallet_fee_percent)+parseFloat(n)+1)),p=!1,m=Ge(o,n,r);m.amount!=t&&i<10;){if(m.amount>t)if(p){m=Ge(o-1,n,r),m.steam_fee+=t-m.amount,m.fees+=t-m.amount,m.amount=t;break}else o--;else p=!0,o++;m=Ge(o,n,r),i++}return m}function Mt(t,n,r){return t<n&&(t=n),t>r&&(t=r),t}function Ge(t,n,r){if(r==null||!r.wallet_fee)return{amount:t};n=n==null?0:n;var i=parseInt(Math.floor(Math.max(t*parseFloat(r.wallet_fee_percent),r.wallet_fee_minimum)+parseInt(r.wallet_fee_base))),o=parseInt(Math.floor(n>0?Math.max(t*n,1):0)),p=t+i+o;return{steam_fee:i,publisher_fee:o,fees:i+o,amount:parseInt(p)}}function Pe(t){for(var n=t+"=",r=document.cookie.split(";"),i=0;i<r.length;i++){for(var o=r[i];o.charAt(0)==" ";)o=o.substring(1,o.length);if(o.indexOf(n)==0)return decodeURIComponent(o.substring(n.length,o.length))}return null}function ct(t){var n=["You cannot sell any items until your previous action completes.","There was a problem listing your item. Refresh the page and try again.","We were unable to contact the game's item server. The game's item server may be down or Steam may be experiencing temporary connectivity issues. Your listing has not been created. Refresh the page and try again."];return n.indexOf(t)!==-1}At('.ui-selected { outline: 2px dashed #FFFFFF; } #logger { color: #767676; font-size: 12px;margin-top:16px; max-height: 200px; overflow-y: auto; }.trade_offer_sum { color: #767676; font-size: 12px;margin-top:8px; }.trade_offer_buttons { margin-top: 12px; }.market_commodity_orders_table { font-size:12px; font-family: "Motiva Sans", Sans-serif; font-weight: 300; }.market_commodity_orders_table th { padding-left: 10px; }#listings_group { display: flex; justify-content: space-between; margin-bottom: 8px; }#listings_sell { text-align: right; color: #589328; font-weight:600; }#listings_buy { text-align: right; color: #589328; font-weight:600; }.market_listing_my_price { height: 50px; padding-right:6px; }.market_listing_edit_buttons.actual_content { width:276px; transition-property: background-color, border-color; transition-timing-function: linear; transition-duration: 0.5s;}.market_listing_buttons { margin-top: 6px; background: rgba(0, 0, 0, 0.4); padding: 5px 0px 1px 0px; }.market_listing_button { margin-right: 4px; }.market_listing_button_right { float:right; }.market_listing_button:first-child { margin-left: 4px; }.market_listing_label_right { float:right; font-size:12px; margin-top:1px; }.market_listing_select { position: absolute; top: 16px;right: 10px; display: flex; }#market_listing_relist { vertical-align: middle; position: relative; bottom: -1px; right: 2px; }.pick_and_sell_button > a { vertical-align: middle; }.market_relist_auto { margin-bottom: 8px;  }.market_relist_auto_label { margin-right: 6px;  }.quick_sell { margin-right: 4px; }.spinner{margin:10px auto;width:50px;height:40px;text-align:center;font-size:10px;}.spinner > div{background-color:#ccc;height:100%;width:6px;display:inline-block;-webkit-animation:sk-stretchdelay 1.2s infinite ease-in-out;animation:sk-stretchdelay 1.2s infinite ease-in-out}.spinner .rect2{-webkit-animation-delay:-1.1s;animation-delay:-1.1s}.spinner .rect3{-webkit-animation-delay:-1s;animation-delay:-1s}.spinner .rect4{-webkit-animation-delay:-.9s;animation-delay:-.9s}.spinner .rect5{-webkit-animation-delay:-.8s;animation-delay:-.8s}@-webkit-keyframes sk-stretchdelay{0%,40%,100%{-webkit-transform:scaleY(0.4)}20%{-webkit-transform:scaleY(1.0)}}@keyframes sk-stretchdelay{0%,40%,100%{transform:scaleY(0.4);-webkit-transform:scaleY(0.4)}20%{transform:scaleY(1.0);-webkit-transform:scaleY(1.0)}}#market_name_search { float: right; background: rgba(0, 0, 0, 0.25); color: white; border: none;height: 25px; padding-left: 6px;}.price_option_price { width: 100px }#see_settings { background: #26566c; margin-right: 10px; height: 24px; line-height:24px; display:inline-block; padding: 0px 6px; }.inventory_item_price { top: 0px;position: absolute;right: 0;background: #3571a5;padding: 2px;color: white; font-size:11px; border: 1px solid #666666;}.separator-large {display:inline-block;width:6px;}.separator-small {display:inline-block;width:1px;}.separator-btn-right {margin-right:12px;}.pagination { padding-left: 0px; }.pagination li { display:inline-block; padding: 5px 10px;background: rgba(255, 255, 255, 0.10); margin-right: 6px; border: 1px solid #666666; }.pagination li.active { background: rgba(255, 255, 255, 0.25); }'),e(document).ready(function(){!De||(Z==Oe&&Jt(),(Z==Ne||Z==He)&&Vt(),Z==_e&&Wt())});function At(t){var n,r;n=document.getElementsByTagName("head")[0],n&&(r=document.createElement("style"),r.type="text/css",r.innerHTML=t,n.appendChild(r))}function ut(t){var n=document.createElement("script");n.setAttribute("type","application/javascript"),n.textContent="("+t+")();",document.body.appendChild(n),document.body.removeChild(n)}if(e.fn.delayedEach=function(t,n,r){var i,o;i=this,o=function(p){var m;if(p>=i.length){if(!r)return;p=0}m=i[p],n.call(m,p,m),setTimeout(function(){o(++p)},t)},o(0)},String.prototype.replaceAll=function(t,n){var r=this;return r.replace(new RegExp(t,"g"),n)},Z==Ne||Z==He){let t=function(c){var l=c.trim().replace("--","00");return(l[l.length-1]==="."||l[l.length-1]===",")&&(l=l.slice(0,-1)),l.indexOf(".")===-1&&l.indexOf(",")===-1&&(l=l+",00"),parseInt(ee(l))},n=function(c,l,d){var g=unsafeWindow.g_rgAssets[c.appid][c.contextid][c.assetid],w=xe(g),I=c.appid,k=e(X(c.listingid).elm),G=g.type,U=t(e(".market_listing_price > span:nth-child(1) > span:nth-child(1)",k).text());if(U<=y(be)*100)return e(".market_listing_my_price",k).last().css("background",kt),e(".market_listing_my_price",k).last().prop("title","The price is not checked."),k.addClass("not_checked"),d(!0,!0);var N=je(g),W={appid:parseInt(I),description:{market_hash_name:w}},a=0;h.getPriceHistory(W,!0,function(u,_,s){u&&(C("Failed to get price history for "+G),u==E&&(a+=1)),h.getItemOrdersHistogram(W,!0,function(f,v,b){if(f&&(C("Failed to get orders histogram for "+G),f==E&&(a+=1)),a>0&&!l)return d(!1,s&&b);var O=v==null||v.highest_buy_order==null?"-":v.highest_buy_order/100+$;e(".market_table_value > span:nth-child(1) > span:nth-child(1) > span:nth-child(1)",k).append(' \u27A4 <span title="This is likely the highest buy order price.">'+O+"</span>"),C("============================"),C(JSON.stringify(c)),C(G+": "+g.name),C("Current price: "+U/100);var L=Le(_,v,!1,N.minPriceBeforeFees,N.maxPriceBeforeFees),q=Le(_,v,!0,N.minPriceBeforeFees,N.maxPriceBeforeFees),R=h.getPriceIncludingFees(L);return C("Calculated price: "+R/100+" ("+L/100+")"),k.addClass("price_"+q),e(".market_listing_my_price",k).last().prop("title","The best price is "+R/100+$+"."),R<U?(C("Sell price is too high."),e(".market_listing_my_price",k).last().css("background",ht),k.addClass("overpriced"),y(ue)==1&&i(c.listingid)):R>U?(C("Sell price is too low."),e(".market_listing_my_price",k).last().css("background",vt),k.addClass("underpriced")):(C("Sell price is fair."),e(".market_listing_my_price",k).last().css("background",gt),k.addClass("fair")),d(!0,s&&b)})})},r=function(c,l,d){var g=X(c.listing).elm;h.removeListing(c.listing,function(w,I){if(!w)e(".actual_content",g).css("background",$e),setTimeout(function(){var k=e(".header_notification_items").first().attr("href")+"json/",G=e(".market_listing_item_name_link",g).first().attr("href"),U=G.lastIndexOf("/")+1,N=G.substring(U),W=decodeURIComponent(G.substring(U)),a=-1;unsafeWindow.RequestFullInventory(k+c.appid+"/"+c.contextid+"/",{},null,null,function(u){if(u.responseJSON&&u.responseJSON.success){var _=u.responseJSON.rgInventory;for(var s in _)if(_t.indexOf(s)==-1&&_[s].appid==c.appid&&(_[s].market_hash_name==W||_[s].market_hash_name==N)){a=s;break}if(a==-1)return e(".actual_content",g).css("background",ne),d(!1);c.assetid=a,_t.push(a),h.sellItem(c,c.sellPrice,function(f){return f?(e(".actual_content",g).css("background",ne),d(!1)):(e(".actual_content",g).css("background",de),setTimeout(function(){re(c.listing)},3e3),d(!0))})}else return e(".actual_content",g).css("background",ne),d(!1)})},F(1500,2500));else return e(".actual_content",g).css("background",ne),d(!1)})},i=function(c){var l=m(c),d=e(X(c).elm),g=-1,w=e(d).attr("class").split(" ");for(var I in w)w[I].toString().includes("price_")&&(g=parseInt(w[I].toString().replace("price_","")));g>0&&Lt.push({listing:c,assetid:l.assetid,contextid:l.contextid,appid:l.appid,sellPrice:g})},o=function(c,l,d){var g=X(c).elm;h.removeListing(c,function(w,I){return w?(e(".actual_content",g).css("background",ne),d(!1)):(e(".actual_content",g).css("background",de),setTimeout(function(){re(c);var k=j[0].size;k>0&&(e("#my_market_selllistings_number").text(k.toString()),e("#my_market_activelistings_number").text(k.toString()))},3e3),d(!0))})},p=function(){e(".market_home_listing_table").each(function(k){e(".my_market_header",e(this)).length!=0&&(e(this).attr("id")?e(this).children().last().addClass("market_listing_see"):(e(this).attr("id","market-listing-"+k),e(this).append('<div class="market_listing_see" id="market-listing-container-'+k+'"></div>'),e(".market_listing_row",e(this)).appendTo(e("#market-listing-container-"+k))),T(e(".market_listing_see",this).last()),H(e(this),!1,!1,!0))});for(var c=0,l=0,d=0;d<j.length;d++)for(var g=0;g<j[d].items.length;g++){var w=ee(j[d].items[g].values().market_listing_item_name),I=m(w);isNaN(I.priceBuyer)||(c+=I.priceBuyer),isNaN(I.priceSeller)||(l+=I.priceSeller),Je.push({listingid:w,appid:I.appid,contextid:I.contextid,assetid:I.assetid})}e("#my_market_selllistings_number").append('<span id="my_market_sellistings_total_price">, '+(c/100).toFixed(2)+$+" \u27A4 "+(l/100).toFixed(2)+$+"</span>")},m=function(c){var l=X(c);if(l==null)return{};var d=e(".item_market_action_button",l.elm).attr("href");if(d==null||d.toLowerCase().includes("cancelmarketbuyorder"))return{};var g=t(e(".market_listing_price > span:nth-child(1) > span:nth-child(1)",l.elm).text()),w=t(e(".market_listing_price > span:nth-child(1) > span:nth-child(3)",l.elm).text()),I=d.split(","),k=ee(I[2]),G=ee(I[3]),U=ee(I[4]);return{appid:k,contextid:G,assetid:U,priceBuyer:g,priceSeller:w}},T=function(c){c.addClass("list"),c.before('<ul class="paginationTop pagination"></ul>'),c.after('<ul class="paginationBottom pagination"></ul>'),e(".market_listing_table_header",c.parent()).append('<input class="search" id="market_name_search" placeholder="Search..." />');var l={valueNames:["market_listing_game_name","market_listing_item_name_link","market_listing_price","market_listing_listed_date",{name:"market_listing_item_name",attr:"id"}],pagination:[{name:"paginationTop",paginationClass:"paginationTop",innerWindow:100,outerWindow:100,left:100,right:100},{name:"paginationBottom",paginationClass:"paginationBottom",innerWindow:100,outerWindow:100,left:100,right:100}],page:parseInt(y(Se))},d=new List(c.parent().attr("id"),l);d.on("searchComplete",x),j.push(d)},A=function(){e(".market_listing_row").each(function(){e(".market_listing_select",this).length==0&&(e(".market_listing_cancel_button",e(this)).append('<div class="market_listing_select"><input type="checkbox" class="market_select_item"/></div>'),e(".market_select_item",this).change(function(c){x()}))})},K=function(){if(A(),Z==Ne){var c=0,l=0;if(typeof unsafeWindow.g_oMyListings!="undefined"&&unsafeWindow.g_oMyListings!=null&&unsafeWindow.g_oMyListings.m_cTotalCount!=null?l=unsafeWindow.g_oMyListings.m_cTotalCount:l=parseInt(e("#my_market_selllistings_number").text()),isNaN(l)||l==0){p();return}for(e("#tabContentsMyActiveMarketListingsRows").html(""),e("#tabContentsMyActiveMarketListingsRows").hide(),e("#tabContentsMyActiveMarketListings_ctn").hide(),e(".market_pagesize_options").hide(),e(".my_market_header").eq(0).append('<div id="market_listings_spinner">'+Me+'<div style="text-align:center">Loading market listings</div></div>');c<l;)dt.push(c),c+=100}else e(".market_home_listing_table").each(function(d){e("#market_buyorder_info_show_details",e(this)).length>0||(e(this).children().last().addClass("market_listing_see"),T(e(".market_listing_see",this).last()),H(e(this),!1,!1,!0))}),e("#tabContentsMyActiveMarketListingsRows > .market_listing_row").each(function(){var d=e(this).attr("id").replace("mylisting_","").replace("mybuyorder_","").replace("mbuyorder_",""),g=m(d),w=null;for(var I in unsafeWindow.g_rgAssets)for(var k in unsafeWindow.g_rgAssets[I])for(var G in unsafeWindow.g_rgAssets[I][k]){w=unsafeWindow.g_rgAssets[I][k][G];break}unsafeWindow.g_rgAssets[I][k][g.assetid]=w,Je.push({listingid:d,appid:g.appid,contextid:g.contextid,assetid:g.assetid})})},x=function(){e(".market_listing_buttons").each(function(){var c=e(this).parent().parent(),l=e(".market_select_item:checked",c).length==e(".market_select_item",c).length;e(".market_select_item",c).length==0&&(l=!1),e(".select_all > span",c).text(l?"Deselect all":"Select all")})},H=function(c,l,d,g){var w=P(c);if(w==null){console.log("Invalid parameter, could not find a list matching elem.");return}var I=l?1:d?2:3,k=!0;let G="\u{1F87B}",U="\u{1F879}";e(".market_listing_table_header > span",c).each(function(){e(this).hasClass("market_listing_edit_buttons")||(e(this).text().includes(U)&&(k=!1),e(this).text(e(this).text().replace(" "+G,"").replace(" "+U,"")))});var N;if(l?N=e(".market_listing_table_header",c).children().eq(1):d?N=e(".market_listing_table_header",c).children().eq(2):g&&(N=e(".market_listing_table_header",c).children().eq(3)),N.text(N.text()+" "+(k?U:G)),w.sort!=null)if(g)w.sort("",{order:k?"asc":"desc",sortFunction:function(a,u){return a.values().market_listing_game_name.toLowerCase().localeCompare(u.values().market_listing_game_name.toLowerCase())==0?a.values().market_listing_item_name_link.toLowerCase().localeCompare(u.values().market_listing_item_name_link.toLowerCase()):a.values().market_listing_game_name.toLowerCase().localeCompare(u.values().market_listing_game_name.toLowerCase())}});else if(d){var W=Be.local().month;w.sort("market_listing_listed_date",{order:k?"asc":"desc",sortFunction:function(a,u){var _=Be.fromString(a.values().market_listing_listed_date.trim(),"d MMM"),s=Be.fromString(u.values().market_listing_listed_date.trim(),"d MMM");return _==null||s==null?0:(_.month>W&&(_=_.plus({years:-1})),s.month>W&&(s=s.plus({years:-1})),_>s?1:_===s?0:-1)}})}else l&&w.sort("market_listing_price",{order:k?"asc":"desc",sortFunction:function(a,u){var _=e(a.values().market_listing_price).text();_=_.substr(0,_.indexOf("(")),_=_.replace("--","00");var s=e(u.values().market_listing_price).text();s=s.substr(0,s.indexOf("(")),s=s.replace("--","00");var f=parseInt(ee(_)),v=parseInt(ee(s));return f-v}})},P=function(c){for(var l=0;l<j.length;l++)if(c.attr("id")==e(j[l].listContainer).attr("id"))return j[l]},X=function(c){for(var l=j.length-1;l>=0;l--){var d=j[l].get("market_listing_item_name","mylisting_"+c+"_name");if(d!=null&&d.length>0||(d=j[l].get("market_listing_item_name","mbuyorder_"+c+"_name"),d!=null&&d.length>0))return d[0]}},re=function(c){for(var l=0;l<j.length;l++)j[l].remove("market_listing_item_name","mylisting_"+c+"_name"),j[l].remove("market_listing_item_name","mbuyorder_"+c+"_name")},z=function(){e(".my_market_header").first().append('<div class="market_listing_buttons"><a class="item_market_action_button item_market_action_button_green select_all market_listing_button"><span class="item_market_action_button_contents" style="text-transform:none">Select all</span></a><span class="separator-small"></span><a class="item_market_action_button item_market_action_button_green remove_selected market_listing_button"><span class="item_market_action_button_contents" style="text-transform:none">Remove selected</span></a><a class="item_market_action_button item_market_action_button_green relist_selected market_listing_button market_listing_button_right"><span class="item_market_action_button_contents" style="text-transform:none">Relist selected</span></a><span class="separator-small"></span><a class="item_market_action_button item_market_action_button_green relist_overpriced market_listing_button market_listing_button_right"><span class="item_market_action_button_contents" style="text-transform:none">Relist overpriced</span></a><span class="separator-small"></span><a class="item_market_action_button item_market_action_button_green select_overpriced market_listing_button market_listing_button_right"><span class="item_market_action_button_contents" style="text-transform:none">Select overpriced</span></a></div>'),e(".my_market_header").slice(1).append('<div class="market_listing_buttons"><a class="item_market_action_button item_market_action_button_green select_all market_listing_button"><span class="item_market_action_button_contents" style="text-transform:none">Select all</span></a><span class="separator-large"></span><a class="item_market_action_button item_market_action_button_green remove_selected market_listing_button"><span class="item_market_action_button_contents" style="text-transform:none">Remove selected</span></a></div>'),e(".market_listing_table_header").on("click","span",function(){if(!(e(this).hasClass("market_listing_edit_buttons")||e(this).hasClass("item_market_action_button_contents"))){var c=e(".market_listing_table_header",e(this).parent().parent()).children().eq(1).text()==e(this).text(),l=e(".market_listing_table_header",e(this).parent().parent()).children().eq(2).text()==e(this).text(),d=e(".market_listing_table_header",e(this).parent().parent()).children().eq(3).text()==e(this).text();H(e(this).parent().parent(),c,l,d)}}),e(".select_all").on("click","*",function(){for(var c=e(this).parent().parent().parent().parent(),l=P(c),d=e(".market_select_item:checked",c).length==e(".market_select_item",c).length,g=0;g<l.matchingItems.length;g++)e(".market_select_item",l.matchingItems[g].elm).prop("checked",!d);x()}),e("#market_removelisting_dialog_accept").on("click","*",function(){window.location.reload()}),e(".select_overpriced").on("click","*",function(){for(var c=e(this).parent().parent().parent().parent(),l=P(c),d=0;d<l.matchingItems.length;d++)e(l.matchingItems[d].elm).hasClass("overpriced")&&e(".market_select_item",l.matchingItems[d].elm).prop("checked",!0);e(".market_listing_row",c).each(function(g){e(this).hasClass("overpriced")&&e(".market_select_item",e(this)).prop("checked",!0)}),x()}),e(".remove_selected").on("click","*",function(){for(var c=e(this).parent().parent().parent().parent(),l=P(c),d=0;d<l.matchingItems.length;d++)if(e(".market_select_item",e(l.matchingItems[d].elm)).prop("checked")){var g=ee(l.matchingItems[d].values().market_listing_item_name);Ft.push(g)}}),e(".market_relist_auto").change(function(){B(ue,e(".market_relist_auto").is(":checked")?1:0)}),e(".relist_overpriced").on("click","*",function(){for(var c=e(this).parent().parent().parent().parent(),l=P(c),d=0;d<l.matchingItems.length;d++)if(e(l.matchingItems[d].elm).hasClass("overpriced")){var g=ee(l.matchingItems[d].values().market_listing_item_name);i(g)}}),e(".relist_selected").on("click","*",function(){for(var c=e(this).parent().parent().parent().parent(),l=P(c),d=0;d<l.matchingItems.length;d++)if(e(l.matchingItems[d].elm).hasClass("overpriced")&&e(".market_select_item",e(l.matchingItems[d].elm)).prop("checked")){var g=ee(l.matchingItems[d].values().market_listing_item_name);i(g)}}),e("#see_settings").remove(),e("#global_action_menu").prepend('<span id="see_settings"><a href="javascript:void(0)">\u2B16 Steam Economy Enhancer</a></span>'),e("#see_settings").on("click","*",()=>st()),K()};var sn=t,en=n,un=r,_n=i,tn=o,$t=p,zt=m,nn=T,on=A,Zt=K,rn=x,an=H,ln=P,Qt=X,cn=re,Vt=z,_t=[],Je=te.queue(function(c,l){n(c,!1,function(d,g){d?setTimeout(function(){l()},g?0:F(1e3,1500)):setTimeout(function(){n(c,!0,function(w,I){l()})},g?0:F(3e4,45e3))})},1);Je.drain=function(){ut(function(){g_bMarketWindowHidden=!1})};var Lt=te.queue(function(c,l){r(c,!1,function(d){d?setTimeout(function(){l()},F(1e3,1500)):setTimeout(function(){r(c,!0,function(g){l()})},F(3e4,45e3))})},1),Ft=te.queue(function(c,l){o(c,!1,function(d){d?setTimeout(function(){l()},F(50,100)):setTimeout(function(){o(c,!0,function(g){l()})},F(3e4,45e3))})},10),dt=te.queue(function(c,l){e.get(window.location.protocol+"//steamcommunity.com/market/mylistings?count=100&start="+c,function(d){if(!d||!d.success){l();return}var g=e("#tabContentsMyActiveMarketListingsRows"),w=e.parseHTML(d.results_html),I=e(".market_listing_row",w);g.append(I),unsafeWindow.MergeWithAssetArray(d.assets),l()},"json").fail(function(d){l()})},1);dt.drain=function(){var c=e("#tabContentsMyActiveMarketListingsRows");c.checkboxes("range",!0);var l={};e(".market_listing_row",c).each(function(){var d=e(this).attr("id");l[d]?e(this).remove():l[d]=!0,e(".item_market_action_button",this).attr("href").toLowerCase().includes("CancelMarketListingConfirmation".toLowerCase())&&e(this).remove(),e(".item_market_action_button",this).attr("href").toLowerCase().includes("CancelMarketBuyOrder".toLowerCase())&&e(this).remove()}),A(),e("#market_listings_spinner").remove(),c.show(),p(),ut(function(){g_bMarketWindowHidden=!0})}}if(Y.prototype.sellItem=function(t,n,r){var i=Pe("sessionid"),o=t.assetid||t.id;e.ajax({type:"POST",url:"https://steamcommunity.com/market/sellitem/",data:{sessionid:i,appid:t.appid,contextid:t.contextid,assetid:o,amount:1,price:n},success:function(p){p.success===!1&&ct(p.message)?r(E,p):r(D,p)},error:function(p){return r(E,p)},crossDomain:!0,xhrFields:{withCredentials:!0},dataType:"json"})},Y.prototype.removeListing=function(t,n){var r=Pe("sessionid");e.ajax({type:"POST",url:window.location.protocol+"//steamcommunity.com/market/removelisting/"+t,data:{sessionid:r},success:function(i){n(D,i)},error:function(){return n(E)},crossDomain:!0,xhrFields:{withCredentials:!0},dataType:"json"})},Y.prototype.getPriceHistory=function(t,n,r){try{var i=xe(t);if(i==null){r(E);return}var o=t.appid;if(n){var p="pricehistory_"+o+"+"+i;oe.getItem(p).then(function(m){m!=null?r(D,m,!0):h.getCurrentPriceHistory(o,i,r)}).catch(function(m){h.getCurrentPriceHistory(o,i,r)})}else h.getCurrentPriceHistory(o,i,r)}catch(m){return r(E)}},Y.prototype.getGooValue=function(t,n){try{var r=Pe("sessionid");e.ajax({type:"GET",url:this.inventoryUrlBase+"ajaxgetgoovalue/",data:{sessionid:r,appid:t.market_fee_app,assetid:t.assetid,contextid:t.contextid},success:function(i){n(D,i)},error:function(i){return n(E,i)},crossDomain:!0,xhrFields:{withCredentials:!0},dataType:"json"})}catch(i){return n(E)}},Y.prototype.grindIntoGoo=function(t,n){try{var r=Pe("sessionid");e.ajax({type:"POST",url:this.inventoryUrlBase+"ajaxgrindintogoo/",data:{sessionid:r,appid:t.market_fee_app,assetid:t.assetid,contextid:t.contextid,goo_value_expected:t.goo_value_expected},success:function(i){n(D,i)},error:function(i){return n(E,i)},crossDomain:!0,xhrFields:{withCredentials:!0},dataType:"json"})}catch(i){return n(E)}},Y.prototype.unpackBoosterPack=function(t,n){try{var r=Pe("sessionid");e.ajax({type:"POST",url:this.inventoryUrlBase+"ajaxunpackbooster/",data:{sessionid:r,appid:t.market_fee_app,communityitemid:t.assetid},success:function(i){n(D,i)},error:function(i){return n(E,i)},crossDomain:!0,xhrFields:{withCredentials:!0},dataType:"json"})}catch(i){return n(E)}},Y.prototype.getCurrentPriceHistory=function(t,n,r){var i=window.location.protocol+"//steamcommunity.com/market/pricehistory/?appid="+t+"&market_hash_name="+n;e.get(i,function(o){if(!o||!o.success||!o.prices){r(Re);return}for(var p=0;p<o.prices.length;p++)o.prices[p][1]*=100,o.prices[p][2]=parseInt(o.prices[p][2]);var m="pricehistory_"+t+"+"+n;oe.setItem(m,o.prices),r(D,o.prices,!1)},"json").fail(function(o){if(!o||!o.responseJSON)return r(E);if(!o.responseJSON.success){r(Re);return}return r(E)})},Y.prototype.getMarketItemNameId=function(t,n){try{var r=xe(t);if(r==null){n(E);return}var i=t.appid,o="itemnameid_"+i+"+"+r;it.getItem(o).then(function(p){if(p!=null)n(D,p);else return h.getCurrentMarketItemNameId(i,r,n)}).catch(function(p){return h.getCurrentMarketItemNameId(i,r,n)})}catch(p){return n(E)}},Y.prototype.getCurrentMarketItemNameId=function(t,n,r){var i=window.location.protocol+"//steamcommunity.com/market/listings/"+t+"/"+n;e.get(i,function(o){var p=/Market_LoadOrderSpread\( (.+) \);/.exec(o);if(p==null){r(Re);return}var m=p[1],T="itemnameid_"+t+"+"+n;it.setItem(T,m),r(D,m)}).fail(function(o){return r(E,o.status)})},Y.prototype.getItemOrdersHistogram=function(t,n,r){try{var i=xe(t);if(i==null){r(E);return}var o=t.appid;if(n){var p="itemordershistogram_"+o+"+"+i;oe.getItem(p).then(function(m){m!=null?r(D,m,!0):h.getCurrentItemOrdersHistogram(t,i,r)}).catch(function(m){h.getCurrentItemOrdersHistogram(t,i,r)})}else h.getCurrentItemOrdersHistogram(t,i,r)}catch(m){return r(E)}},Y.prototype.getCurrentItemOrdersHistogram=function(t,n,r){h.getMarketItemNameId(t,function(i,o){if(i){o!=429?r(Re):r(E);return}var p=window.location.protocol+"//steamcommunity.com/market/itemordershistogram?language=english&currency="+tt+"&item_nameid="+o+"&two_factor=0";e.get(p,function(m){var T="itemordershistogram_"+t.appid+"+"+n;oe.setItem(T,m),r(D,m,!1)}).fail(function(){return r(E,null)})})},Y.prototype.getPriceBeforeFees=function(t,n){var r=-1;n!=null&&(n.market_fee!=null?r=n.market_fee:n.description!=null&&n.description.market_fee!=null&&(r=n.description.market_fee)),r==-1&&(this.walletInfo!=null?r=this.walletInfo.wallet_publisher_fee_percent_default:r=.1),t=Math.round(t);var i=Rt(t,r,this.walletInfo);return t-i.fees},Y.prototype.getPriceIncludingFees=function(t,n){var r=-1;n!=null&&(n.market_fee!=null?r=n.market_fee:n.description!=null&&n.description.market_fee!=null&&(r=n.description.market_fee)),r==-1&&(this.walletInfo!=null?r=this.walletInfo.wallet_publisher_fee_percent_default:r=.1),t=Math.round(t);var i=Ge(t,r,this.walletInfo);return i.amount},Z==Oe){let t=function(){ze.length()==0&&ae.length()==0&&Ke.length()==0&&Xe.length()==0&&e("#inventory_items_spinner").remove()},n=function(){e("#loggerTotal").length==0&&e(Ce).parent().append('<div id="loggerTotal"></div>');var a=document.getElementById("loggerTotal");a.innerHTML="",Ue>0&&(a.innerHTML+="<div><strong>Total listed for "+(Ue/100).toFixed(2)+$+", you will receive "+(et/100).toFixed(2)+$+".</strong></div>"),qe>0&&(a.innerHTML+="<div><strong>Total scrap "+qe+".</strong></div>")},r=function(a){N().then(function(){var u=W(),_=[];u.forEach(function(s){!s.marketable||_.push(s)}),P(_)},function(){M("Could not retrieve the inventory...")})},i=function(){N().then(function(){var a=W(),u=[];a.forEach(function(_){!Ve(_)||!_.marketable||u.push(_)}),P(u)},function(){M("Could not retrieve the inventory...")})},o=function(){N().then(function(){var a=W(),u=[];a.forEach(function(_){!Nt(_)||!_.marketable||u.push(_)}),P(u)},function(){M("Could not retrieve the inventory...")})},p=function(a,u){var _=0,s=a.name||a.description.name,f=a.assetid||a.id;h.getGooValue(a,function(v,b){se++;var O=Ye(Q),L=Fe(""+se,O)+" / "+Q;if(v!=D)return C("Failed to get gems value for "+s),M(L+" - "+s+" not turned into gems due to missing gems value."),e("#"+a.appid+"_"+a.contextid+"_"+f).css("background",ne),u(!1);a.goo_value_expected=parseInt(b.goo_value),h.grindIntoGoo(a,function(q,R){if(q!=D)return C("Failed to turn item into gems for "+s),M(L+" - "+s+" not turned into gems due to unknown error."),e("#"+a.appid+"_"+a.contextid+"_"+f).css("background",ne),u(!1);C("============================"),C(s),C("Turned into "+b.goo_value+" gems"),M(L+" - "+s+" turned into "+a.goo_value_expected+" gems."),e("#"+a.appid+"_"+a.contextid+"_"+f).css("background",de),qe+=a.goo_value_expected,n(),u(!0)})})},m=function(a,u){var _=0,s=a.name||a.description.name,f=a.assetid||a.id;h.unpackBoosterPack(a,function(v,b){se++;var O=Ye(Q),L=Fe(""+se,O)+" / "+Q;if(v!=D)return C("Failed to unpack booster pack "+s),M(L+" - "+s+" not unpacked."),e("#"+a.appid+"_"+a.contextid+"_"+f).css("background",ne),u(!1);M(L+" - "+s+" unpacked."),e("#"+a.appid+"_"+a.contextid+"_"+f).css("background",de),u(!0)})},T=function(){var a=z();N().then(function(){var u=W(),_=0;u.forEach(function(s){if(s.queued==null&&s.owner_actions!=null){var f=!1;for(var v in s.owner_actions)s.owner_actions[v].link!=null&&s.owner_actions[v].link.includes("GetGooValue")&&(f=!0);if(!!f){var b=s.assetid||s.id;a.indexOf(b)!==-1&&(s.queued=!0,Ke.push(s),_++)}}}),_>0&&(Q+=_,e("#inventory_items_spinner").remove(),e("#inventory_sell_buttons").append('<div id="inventory_items_spinner">'+Me+'<div style="text-align:center">Processing '+_+" items</div></div>"))},function(){M("Could not retrieve the inventory...")})},A=function(){var a=z();N().then(function(){var u=W(),_=0;u.forEach(function(s){if(s.queued==null&&s.owner_actions!=null){var f=!1;for(var v in s.owner_actions)s.owner_actions[v].link!=null&&s.owner_actions[v].link.includes("OpenBooster")&&(f=!0);if(!!f){var b=s.assetid||s.id;a.indexOf(b)!==-1&&(s.queued=!0,Xe.push(s),_++)}}}),_>0&&(Q+=_,e("#inventory_items_spinner").remove(),e("#inventory_sell_buttons").append('<div id="inventory_items_spinner">'+Me+'<div style="text-align:center">Processing '+_+" items</div></div>"))},function(){M("Could not retrieve the inventory...")})},K=function(){c(function(a){P(a)})},x=function(a){var u=a[0].appid,_=a[0].contextid,s=!1;return a.forEach(function(f){(f.contextid!=_||f.commodity==!1)&&(s=!0)}),!s},H=function(){c(function(a){var u=a[0].appid,_=a[0].contextid,s={};a.forEach(function(q){s[q.market_hash_name]=s[q.market_hash_name]+1||1});var f="";for(var v in s)f+="&items[]="+encodeURI(v)+"&qty[]="+s[v];var b="https://steamcommunity.com/market/multisell",O=b+"?appid="+u+"&contextid="+_+f,L=unsafeWindow.ShowDialog("Steam Economy Enhancer",'<iframe frameBorder="0" height="650" width="900" src="'+O+'"></iframe>');L.OnDismiss(function(){a.forEach(function(q){var R=q.assetid||q.id;e("#"+q.appid+"_"+q.contextid+"_"+R).css("background",$e)})})})},P=function(a){if(a.length==0){M("These items cannot be added to the market...");return}var u=0;a.forEach(function(_,s,f){if(_.queued==null){_.queued=!0;var v=_.assetid||_.id;_.ignoreErrors=!1,ze.push(_),u++}}),u>0&&(Q+=u,e("#inventory_items_spinner").remove(),e("#inventory_sell_buttons").append('<div id="inventory_items_spinner">'+Me+'<div style="text-align:center">Processing '+u+" items</div></div>"))},X=function(a,u,_){var s=je(a),f=0,v=a.name||a.description.name;h.getPriceHistory(a,!0,function(b,O,L){b&&(C("Failed to get price history for "+v),b==E&&(f+=1)),h.getItemOrdersHistogram(a,!0,function(q,R,We){if(q&&(C("Failed to get orders histogram for "+v),q==E&&(f+=1)),f>0&&!u)return _(!1,L&&We);C("============================"),C(v);var le=Le(O,R,!0,s.minPriceBeforeFees,s.maxPriceBeforeFees);return C("Sell price: "+le/100+" ("+h.getPriceIncludingFees(le)/100+")"),ae.push({item:a,sellPrice:le}),_(!0,L&&We)})})},re=function(){var a=unsafeWindow.g_ActiveUser.strSteamId==unsafeWindow.g_steamID,u=-1;if(G(a),e(".games_list_tabs").on("click","*",function(){G(a)}),!!a){var _=".itemHolder:not([style*=none])";e("#inventories").selectable({filter:_,selecting:function(s,f){var v=e(f.selecting.tagName,s.target).index(f.selecting);s.shiftKey&&u>-1?(e(f.selecting.tagName,s.target).slice(Math.min(u,v),1+Math.max(u,v)).each(function(){e(this).is(_)&&e(this).addClass("ui-selected")}),u=-1):u=v},selected:function(s,f){k(f.selected)}})}},z=function(){var a=[];return e(".inventory_ctn").each(function(){e(this).find(".inventory_page").each(function(){var u=this;e(u).find(".itemHolder").each(function(){!e(this).hasClass("ui-selected")||e(this).find(".item").each(function(){var _=this.id.match(/_(\-?\d+)$/);_&&a.push(_[1])})})})}),a},c=function(a){var u=z();N().then(function(){var _=W(),s=[];_.forEach(function(f){if(!!f.marketable){var v=f.assetid||f.id;u.indexOf(v)!==-1&&s.push(f)}}),a(s)},function(){M("Could not retrieve the inventory...")})},l=function(a){var u=z();N().then(function(){var _=W(),s=[];_.forEach(function(f){var v=!1;for(var b in f.owner_actions)f.owner_actions[b].link!=null&&f.owner_actions[b].link.includes("GetGooValue")&&(v=!0);if(!!v){var O=f.assetid||f.id;u.indexOf(O)!==-1&&s.push(f)}}),a(s)},function(){M("Could not retrieve the inventory...")})},d=function(a){var u=z();N().then(function(){var _=W(),s=[];_.forEach(function(f){var v=!1;for(var b in f.owner_actions)f.owner_actions[b].link!=null&&f.owner_actions[b].link.includes("OpenBooster")&&(v=!0);if(!!v){var O=f.assetid||f.id;u.indexOf(O)!==-1&&s.push(f)}}),a(s)},function(){M("Could not retrieve the inventory...")})},g=function(){c(function(a){var u=a.length;a.length==0?(e(".sell_selected").hide(),e(".sell_manual").hide()):(e(".sell_selected").show(),x(a)?(e(".sell_manual").show(),e(".sell_manual > span").text("Sell "+u+(u==1?" Item Manual":" Items Manual"))):e(".sell_manual").hide(),e(".sell_selected > span").text("Sell "+u+(u==1?" Item":" Items")))})},w=function(){l(function(a){var u=a.length;a.length==0?e(".turn_into_gems").hide():(e(".turn_into_gems").show(),e(".turn_into_gems > span").text("Turn "+u+(u==1?" Item Into Gems":" Items Into Gems")))})},I=function(){d(function(a){var u=a.length;a.length==0?e(".unpack_booster_packs").hide():(e(".unpack_booster_packs").show(),e(".unpack_booster_packs > span").text("Unpack "+u+(u==1?" Booster Pack":" Booster Packs")))})},k=function(L){g(),w(),I();var u=e("div",L).attr("id"),_=S().selectedItem.appid+"_"+S().selectedItem.contextid+"_"+S().selectedItem.assetid;if(u!==_){setTimeout(function(){k(L)},250);return}var s=e(".inventory_iteminfo:visible").first();if(!(s.html().indexOf("checkout/sendgift/")>-1)){var f=s.attr("id"),v=e("#"+f+"_scrap_content");v.next().insertBefore(v);var b=xe(S().selectedItem);if(b!=null){var O=S().selectedItem.appid,L={appid:parseInt(O),description:{market_hash_name:b}};h.getItemOrdersHistogram(L,!1,function(q,R){if(q){C("Failed to get orders histogram for "+(S().selectedItem.name||S().selectedItem.description.name));return}var We=e('<div id="listings_group"><div><div id="listings_sell">Sell</div>'+R.sell_order_table+'</div><div><div id="listings_buy">Buy</div>'+R.buy_order_table+"</div></div>");e("#"+f+"_item_market_actions > div").after(We);var le=e("#"+f+"_item_owner_actions");le.show(),le.append('<a class="btn_small btn_grey_white_innerfade" href="/market/listings/'+O+"/"+b+'"><span>View in Community Market</span></a>'),e("#"+f+"_item_market_actions > div:nth-child(1) > div:nth-child(1)").hide();var Ht=S().selectedItem.name.toLowerCase().endsWith("booster pack");if(Ht){var Ut="/market/search?q=&category_753_Game%5B%5D=tag_app_"+S().selectedItem.market_fee_app+"&category_753_item_class%5B%5D=tag_item_class_2&appid=753";le.append('<br/> <a class="btn_small btn_grey_white_innerfade" href="'+Ut+'"><span>View trading cards in Community Market</span></a>')}var Xt=S().selectedItem.assetid||S().selectedItem.id;if(S().selectedItem.queued==null){var ce=[];R!=null&&R.highest_buy_order!=null&&ce.push(parseInt(R.highest_buy_order)),R!=null&&R.lowest_sell_order!=null&&(parseInt(R.lowest_sell_order)>3&&ce.push(parseInt(R.lowest_sell_order)-1),ce.push(parseInt(R.lowest_sell_order))),ce=ce.filter((V,Qe)=>ce.indexOf(V)===Qe).sort((V,Qe)=>V-Qe);var mt=" ";ce.forEach(function(V){mt+='<a class="item_market_action_button item_market_action_button_green quick_sell" id="quick_sell'+V+'"><span class="item_market_action_button_edge item_market_action_button_left"></span><span class="item_market_action_button_contents">'+V/100+$+'</span><span class="item_market_action_button_edge item_market_action_button_right"></span><span class="item_market_action_button_preload"></span></a>'}),e("#"+f+"_item_market_actions",s).append(mt),e("#"+f+"_item_market_actions",s).append('<div style="display:flex"><input id="quick_sell_input" style="background-color: black;color: white;border: transparent;max-width:65px;text-align:center;" type="number" value="'+R.lowest_sell_order/100+'" step="0.01" />&nbsp;<a class="item_market_action_button item_market_action_button_green quick_sell_custom"><span class="item_market_action_button_edge item_market_action_button_left"></span><span class="item_market_action_button_contents">\u279C Sell</span><span class="item_market_action_button_edge item_market_action_button_right"></span><span class="item_market_action_button_preload"></span></a></div>'),e(".quick_sell").on("click",function(){var V=e(this).attr("id").replace("quick_sell","");V=h.getPriceBeforeFees(V),Q++,ae.push({item:S().selectedItem,sellPrice:V})}),e(".quick_sell_custom").on("click",function(){var V=e("#quick_sell_input",e("#"+f+"_item_market_actions",s)).val()*100;V=h.getPriceBeforeFees(V),Q++,ae.push({item:S().selectedItem,sellPrice:V})})}})}}},G=function(a){e("#inventory_sell_buttons").remove(),e("#price_options").remove(),e("#inventory_reload_button").remove(),e("#see_settings").remove(),e("#global_action_menu").prepend('<span id="see_settings"><a href="javascript:void(0)">\u2B16 Steam Economy Enhancer</a></span>'),e("#see_settings").on("click","*",()=>st());var u=S().m_appid,_=u==753,s=u==440,f=e('<div id="inventory_sell_buttons" style="margin-bottom:12px;"><a class="btn_green_white_innerfade btn_medium_wide sell_all separator-btn-right"><span>Sell All Items</span></a><a class="btn_green_white_innerfade btn_medium_wide sell_selected separator-btn-right" style="display:none"><span>Sell Selected Items</span></a><a class="btn_green_white_innerfade btn_medium_wide sell_manual separator-btn-right" style="display:none"><span>Sell Manually</span></a>'+(_?'<a class="btn_green_white_innerfade btn_medium_wide sell_all_cards separator-btn-right"><span>Sell All Cards</span></a><div style="margin-top:12px;"><a class="btn_darkblue_white_innerfade btn_medium_wide turn_into_gems separator-btn-right" style="display:none"><span>Turn Selected Items Into Gems</span></a><a class="btn_darkblue_white_innerfade btn_medium_wide unpack_booster_packs separator-btn-right" style="display:none"><span>Unpack Selected Booster Packs</span></a></div>':"")+(s?'<a class="btn_green_white_innerfade btn_medium_wide sell_all_crates separator-btn-right"><span>Sell All Crates</span></a>':"")+"</div>"),v=e('<a id="inventory_reload_button" class="btn_darkblue_white_innerfade btn_medium_wide reload_inventory" style="margin-right:12px"><span>Reload Inventory</span></a>');e("#inventory_logos")[0].style.height="auto",e("#inventory_applogo").hide(),e("#inventory_applogo").after(Ce),e("#logger").on("scroll",function(){var b=e("#logger").prop("scrollHeight")-e("#logger").prop("clientHeight")<=e("#logger").prop("scrollTop")+1;ot=!b}),a&&(e("#inventory_applogo").after(f),e(".sell_all").on("click","*",function(){r(u)}),e(".sell_selected").on("click","*",K),e(".sell_manual").on("click","*",H),e(".sell_all_cards").on("click","*",i),e(".sell_all_crates").on("click","*",o),e(".turn_into_gems").on("click","*",T),e(".unpack_booster_packs").on("click","*",A)),e(".inventory_rightnav").prepend(v),e(".reload_inventory").on("click","*",function(){window.location.reload()}),N().then(function(){var b=function(){y(we)==1&&ft(W())};b(),e("#inventory_pagecontrols").observe("childlist","*",function(O){b()})},function(){M("Could not retrieve the inventory...")})},U=function(a){return new Promise(function(u){a.reduce(function(_,s){return _.then(function(){return s.LoadCompleteInventory().done(function(){})})},Promise.resolve()),u()})},N=function(){var a=[];for(var u in S().m_rgChildInventories)a.push(S().m_rgChildInventories[u]);return a.push(S()),U(a)},W=function(){var a=[];for(var u in S().m_rgChildInventories)for(var _ in S().m_rgChildInventories[u].m_rgAssets){var s=S().m_rgChildInventories[u].m_rgAssets[_];typeof s=="object"&&(Object.assign(s,s.description),s.id=_,a.push(s))}for(var _ in S().m_rgAssets){var s=S().m_rgAssets[_];typeof s=="object"&&(Object.assign(s,s.description),s.id=_,a.push(s))}return a};var yn=t,Ln=n,dn=r,In=i,wn=o,Fn=p,Gn=m,En=T,gn=A,Pn=K,mn=x,Tn=H,pn=P,Nn=X,Jt=re,vn=z,On=c,kn=l,hn=d,Sn=g,Rn=w,xn=I,bn=k,Cn=G,Mn=U,fn=N,An=W,ae=te.queue(function(a,u){h.sellItem(a.item,a.sellPrice,function(_,s){se++;var f=Ye(Q),v=a.item.assetid||a.item.id,b=a.item.name||a.item.description.name,O=Fe(""+se,f)+" / "+Q;_?s!=null&&ct(s.message)?(M(O+" - "+b+" retrying listing because "+s.message[0].toLowerCase()+s.message.slice(1)),se--,ae.unshift(a),ae.pause(),setTimeout(function(){ae.resume()},F(3e4,45e3))):(s!=null&&s.responseJSON!=null&&s.responseJSON.message!=null?M(O+" - "+b+" not added to market because "+s.responseJSON.message[0].toLowerCase()+s.responseJSON.message.slice(1)):M(O+" - "+b+" not added to market."),e("#"+a.item.appid+"_"+a.item.contextid+"_"+v).css("background",ne)):(M(O+" - "+b+" listed for "+(h.getPriceIncludingFees(a.sellPrice)/100).toFixed(2)+$+", you will receive "+(a.sellPrice/100).toFixed(2)+$+"."),e("#"+a.item.appid+"_"+a.item.contextid+"_"+v).css("background",de),et+=a.sellPrice,Ue+=h.getPriceIncludingFees(a.sellPrice),n()),u()})},1);ae.drain=function(){t()};var Ke=te.queue(function(a,u){p(a,function(_){if(_)setTimeout(function(){u()},250);else{var s=J>1?F(3e4,45e3):F(1e3,1500);J>3&&(J=0),setTimeout(function(){u()},s)}})},1);Ke.drain=function(){t()};var Xe=te.queue(function(a,u){m(a,function(_){if(_)setTimeout(function(){u()},250);else{var s=J>1?F(3e4,45e3):F(1e3,1500);J>3&&(J=0),setTimeout(function(){u()},s)}})},1);Xe.drain=function(){t()};var ze=te.queue(function(a,u){X(a,a.ignoreErrors,function(_,s){if(_)setTimeout(function(){u()},s?0:F(1e3,1500));else{a.ignoreErrors||(a.ignoreErrors=!0,ze.push(a));var f=J>1?F(3e4,45e3):F(1e3,1500);J>3&&(J=0),setTimeout(function(){u()},s?0:f)}})},1)}if(Z==_e){let t=function(){var r=[];for(var i in S().rgChildInventories)for(var o in S().rgChildInventories[i].rgInventory){var p=S().rgChildInventories[i].rgInventory[o];typeof p=="object"&&(Object.assign(p,p.description),p.id=o,r.push(p))}for(var o in S().rgInventory){var p=S().rgInventory[o];typeof p=="object"&&(Object.assign(p,p.description),p.id=o,r.push(p))}return r},n=function(r,i){for(var o={},p=0,m=0;m<r.length;m++){var T=i.findAsset(r[m].appid,r[m].contextid,r[m].assetid),A="";if(T!=null){if(T.element){var K=e(".inventory_item_price",T.element);if(K.length){var x=K[0],H=e(x).attr("class").split(" ");for(var P in H)if(H[P].toString().includes("price_")){var X=parseInt(H[P].toString().replace("price_",""));p+=X}}}if(T.original_amount!=null&&T.amount!=null){var re=parseInt(T.original_amount),z=parseInt(T.amount),c=re-z;A+=c.toString()+"x "}A+=T.name,T.type!=null&&T.type.length>0&&(A+=" ("+T.type+")")}else A="Unknown Item";A in o?o[A]=o[A]+1:o[A]=1}var l=[];for(var d in o)l.push([d,o[d]]);l.sort(function(w,I){return w[1]-I[1]}).reverse();for(var g="<strong>Number of items: "+l.length+", worth "+(p/100).toFixed(2)+$+"<br/><br/></strong>",m=0;m<l.length;m++)g+=l[m][1]+"x "+l[m][0]+"<br/>";return g};var Kt=t,Bt=n}var pt=0;function Gt(){for(var t=0;t<unsafeWindow.g_rgCurrentTradeStatus.them.assets.length;t++){var n=UserThem.findAsset(unsafeWindow.g_rgCurrentTradeStatus.them.assets[t].appid,unsafeWindow.g_rgCurrentTradeStatus.them.assets[t].contextid,unsafeWindow.g_rgCurrentTradeStatus.them.assets[t].assetid);if(n==null)return!1}for(var t=0;t<unsafeWindow.g_rgCurrentTradeStatus.me.assets.length;t++){var n=UserYou.findAsset(unsafeWindow.g_rgCurrentTradeStatus.me.assets[t].appid,unsafeWindow.g_rgCurrentTradeStatus.me.assets[t].contextid,unsafeWindow.g_rgCurrentTradeStatus.me.assets[t].assetid);if(n==null)return!1}return!0}function Wt(){var t=function(){y(Te)==1&&ft(Kt())},n=function(){for(var r=[],i=0;i<unsafeWindow.g_rgCurrentTradeStatus.them.assets.length;i++){var o=UserThem.findAsset(unsafeWindow.g_rgCurrentTradeStatus.them.assets[i].appid,unsafeWindow.g_rgCurrentTradeStatus.them.assets[i].contextid,unsafeWindow.g_rgCurrentTradeStatus.them.assets[i].assetid);r.push(o)}for(var i=0;i<unsafeWindow.g_rgCurrentTradeStatus.me.assets.length;i++){var o=UserYou.findAsset(unsafeWindow.g_rgCurrentTradeStatus.me.assets[i].appid,unsafeWindow.g_rgCurrentTradeStatus.me.assets[i].contextid,unsafeWindow.g_rgCurrentTradeStatus.me.assets[i].assetid);r.push(o)}ft(r)};e(".trade_right > div > div > div > .trade_item_box").observe("childlist subtree",function(r){if(!!Gt()){var i=unsafeWindow.g_rgCurrentTradeStatus.me.assets.length+unsafeWindow.g_rgCurrentTradeStatus.them.assets.length;pt!=i&&n(),pt=i,e("#trade_offer_your_sum").remove(),e("#trade_offer_their_sum").remove();var o=Bt(unsafeWindow.g_rgCurrentTradeStatus.me.assets,UserYou),p=Bt(unsafeWindow.g_rgCurrentTradeStatus.them.assets,UserThem);e("div.offerheader:nth-child(1) > div:nth-child(3)").append('<div class="trade_offer_sum" id="trade_offer_your_sum">'+o+"</div>"),e("div.offerheader:nth-child(3) > div:nth-child(3)").append('<div class="trade_offer_sum" id="trade_offer_their_sum">'+p+"</div>")}}),t(),e("#inventory_pagecontrols").observe("childlist","*",function(r){t()}),window.location.href.includes("tradeoffer/new")&&(e("#inventory_displaycontrols").append('<br/><div class="trade_offer_buttons"><a class="item_market_action_button item_market_action_button_green select_all" style="margin-top:1px"><span class="item_market_action_button_contents" style="text-transform:none">Select all from page</span></a></div>'),e(".select_all").on("click","*",function(){e(".inventory_ctn:visible > .inventory_page:visible > .itemHolder:visible").delayedEach(250,function(r,i){var o=i.rgItem;o.is_stackable||!o.tradable||unsafeWindow.MoveItemToTrade(i)})}))}if(Z==Oe||Z==_e){let t=function(){return unsafeWindow.g_ActiveInventory},n=function(i){Ze.kill(),i.forEach(function(o){!o.marketable||!e(o.element).is(":visible")||Ze.push(o)})},r=function(i,o,p){var m=je(i),T=0,A=i.name||i.description.name;h.getItemOrdersHistogram(i,!0,function(K,x,H){if(K&&(C("Failed to get orders histogram for "+A),K==E&&(T+=1)),T>0&&!o)return p(!1,H);var P=Le(null,x,!1,0,65535),X=P==65535?"\u221E":(h.getPriceIncludingFees(P)/100).toFixed(2)+$,re=(Z==_e?"#item":"#")+i.appid+"_"+i.contextid+"_"+i.id,z=e(re);return e(".inventory_item_price",z).remove(),z.append('<span class="inventory_item_price price_'+(P==65535?0:h.getPriceIncludingFees(P))+'">'+X+"</span>"),p(!0,H)})};var S=t,ft=n,Wn=r,Ze=te.queue(function(i,o){r(i,!1,function(p,m){if(p)setTimeout(function(){o()},m?0:F(1e3,1500));else{i.ignoreErrors||(i.ignoreErrors=!0,Ze.push(i)),J++;var T=J>1?F(3e4,45e3):F(1e3,1500);J>3&&(J=0),setTimeout(function(){o()},m?0:T)}})},1)}})(jQuery,async);})();
